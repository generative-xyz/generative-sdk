{"version":3,"file":"index.js","sources":["../build/compiled/bitcoin/constants.js","../build/compiled/bitcoin/utils.js","../build/compiled/bitcoin/tx.js","../build/compiled/bitcoin/wallet.js","../build/compiled/bitcoin/psbt.js"],"sourcesContent":["import { networks, } from \"bitcoinjs-lib\";\nconst BlockStreamURL = \"https://blockstream.info/api\";\nconst MinSatInscription = 546;\nconst network = networks.bitcoin; // mainnet\nconst DummyUTXOValue = 1000;\nexport { BlockStreamURL, MinSatInscription, network, DummyUTXOValue, };\n//# sourceMappingURL=constants.js.map","const wif = require(\"wif\");\nimport { initEccLib, crypto, payments } from \"bitcoinjs-lib\";\nimport { network } from \"./constants\";\nimport { ECPairFactory } from \"ecpair\";\nimport * as ecc from \"@bitcoinerlab/secp256k1\";\ninitEccLib(ecc);\nconst ECPair = ECPairFactory(ecc);\n/**\n* convertPrivateKey converts buffer private key to WIF private key string\n* @param bytes buffer private key\n* @returns the WIF private key string\n*/\nconst convertPrivateKey = (bytes) => {\n    return wif.encode(128, bytes, true);\n};\n/**\n* estimateTxFee estimates the transaction fee\n* @param numIns number of inputs in the transaction\n* @param numOuts number of outputs in the transaction\n* @param feeRatePerByte fee rate per byte (in satoshi)\n* @returns returns the estimated transaction fee in satoshi\n*/\nconst estimateTxFee = (numIns, numOuts, feeRatePerByte) => {\n    const fee = (68 * numIns + 43 * numOuts) * feeRatePerByte;\n    return fee;\n};\n/**\n* estimateNumInOutputs estimates number of inputs and outputs by parameters:\n* @param inscriptionID id of inscription to send (if any)\n* @param sendAmount satoshi amount need to send\n* @param isUseInscriptionPayFee use inscription output coin to pay fee or not\n* @returns returns the estimated number of inputs and outputs in the transaction\n*/\nconst estimateNumInOutputs = (inscriptionID, sendAmount, isUseInscriptionPayFee) => {\n    let numOuts = 0;\n    let numIns = 0;\n    if (inscriptionID !== \"\") {\n        numOuts++;\n        numIns++;\n    }\n    if (sendAmount > 0) {\n        numOuts++;\n    }\n    if (sendAmount > 0 || !isUseInscriptionPayFee) {\n        numIns++;\n        numOuts++; // for change BTC output\n    }\n    return { numIns, numOuts };\n};\nfunction toXOnly(pubkey) {\n    return pubkey.subarray(1, 33);\n}\nfunction tweakSigner(signer, opts = {}) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    let privateKey = signer.privateKey;\n    if (!privateKey) {\n        throw new Error(\"Private key is required for tweaking signer!\");\n    }\n    if (signer.publicKey[0] === 3) {\n        privateKey = ecc.privateNegate(privateKey);\n    }\n    const tweakedPrivateKey = ecc.privateAdd(privateKey, tapTweakHash(toXOnly(signer.publicKey), opts.tweakHash));\n    if (!tweakedPrivateKey) {\n        throw new Error(\"Invalid tweaked private key!\");\n    }\n    return ECPair.fromPrivateKey(Buffer.from(tweakedPrivateKey), {\n        network: opts.network,\n    });\n}\nfunction tapTweakHash(pubKey, h) {\n    return crypto.taggedHash(\"TapTweak\", Buffer.concat(h ? [pubKey, h] : [pubKey]));\n}\nconst generateTaprootAddress = (privateKey) => {\n    const keyPair = ECPair.fromPrivateKey(privateKey);\n    const internalPubkey = toXOnly(keyPair.publicKey);\n    const { address } = payments.p2tr({\n        internalPubkey,\n    });\n    return address ? address : \"\";\n};\nconst generateTaprootKeyPair = (privateKey) => {\n    // init key pair from senderPrivateKey\n    const keyPair = ECPair.fromPrivateKey(privateKey);\n    // Tweak the original keypair\n    const tweakedSigner = tweakSigner(keyPair, { network });\n    // Generate an address from the tweaked public key\n    const p2pktr = payments.p2tr({\n        pubkey: toXOnly(tweakedSigner.publicKey),\n        network\n    });\n    const senderAddress = p2pktr.address ? p2pktr.address : \"\";\n    if (senderAddress === \"\") {\n        throw new Error(\"Can not get sender address from private key\");\n    }\n    return { keyPair, senderAddress, tweakedSigner, p2pktr };\n};\nexport { convertPrivateKey, estimateTxFee, estimateNumInOutputs, toXOnly, tweakSigner, tapTweakHash, ECPair, generateTaprootAddress, generateTaprootKeyPair, };\n//# sourceMappingURL=utils.js.map","import { networks, payments, Psbt } from \"bitcoinjs-lib\";\nimport axios from \"axios\";\nimport { BlockStreamURL, MinSatInscription } from \"./constants\";\nimport { toXOnly, tweakSigner, ECPair, estimateTxFee, estimateNumInOutputs } from \"./utils\";\n/**\n* selectUTXOs selects the most reasonable UTXOs to create the transaction.\n* if sending inscription, the first selected UTXO is always the UTXO contain inscription.\n* @param utxos list of utxos (include non-inscription and inscription utxos)\n* @param inscriptions list of inscription infos of the sender\n* @param sendInscriptionID id of inscription to send\n* @param sendAmount satoshi amount need to send\n* @param feeRatePerByte fee rate per byte (in satoshi)\n* @param isUseInscriptionPayFee flag defines using inscription coin to pay fee\n* @returns the list of selected UTXOs\n* @returns the actual flag using inscription coin to pay fee\n* @returns the value of inscription outputs, and the change amount (if any)\n* @returns the network fee\n*/\nconst selectUTXOs = (utxos, inscriptions, sendInscriptionID, sendAmount, feeRatePerByte, isUseInscriptionPayFee) => {\n    const resultUTXOs = [];\n    let normalUTXOs = [];\n    let inscriptionUTXO = null;\n    let inscriptionInfo = null;\n    let valueOutInscription = 0;\n    let changeAmount = 0;\n    let maxAmountInsTransfer = 0;\n    // convert feeRate to interger\n    feeRatePerByte = Math.round(feeRatePerByte);\n    // estimate fee\n    const { numIns, numOuts } = estimateNumInOutputs(sendInscriptionID, sendAmount, isUseInscriptionPayFee);\n    const estFee = estimateTxFee(numIns, numOuts, feeRatePerByte);\n    // when BTC amount need to send is greater than 0, \n    // we should use normal BTC to pay fee\n    if (isUseInscriptionPayFee && sendAmount > 0) {\n        isUseInscriptionPayFee = false;\n    }\n    // filter normal UTXO and inscription UTXO to send\n    utxos.forEach(utxo => {\n        // txIDKey = tx_hash:tx_output_n\n        let txIDKey = utxo.tx_hash.concat(\":\");\n        txIDKey = txIDKey.concat(utxo.tx_output_n.toString());\n        // try to get inscriptionInfos\n        const inscriptionInfos = inscriptions[txIDKey];\n        if (inscriptionInfos === undefined || inscriptionInfos === null || inscriptionInfos.length == 0) {\n            // normal UTXO\n            normalUTXOs.push(utxo);\n        }\n        else {\n            // inscription UTXO\n            if (sendInscriptionID !== \"\") {\n                const inscription = inscriptionInfos.find(ins => ins.id === sendInscriptionID);\n                if (inscription !== undefined) {\n                    // don't support send tx with outcoin that includes more than one inscription\n                    if (inscriptionInfos.length > 1) {\n                        throw new Error(`InscriptionID ${{ sendInscriptionID }} is not supported to send.`);\n                    }\n                    inscriptionUTXO = utxo;\n                    inscriptionInfo = inscription;\n                    maxAmountInsTransfer = (inscriptionUTXO.value - inscriptionInfo.offset - 1) - MinSatInscription;\n                    console.log(\"maxAmountInsTransfer: \", maxAmountInsTransfer);\n                }\n            }\n        }\n    });\n    if (sendInscriptionID !== \"\") {\n        if (inscriptionUTXO === null || inscriptionInfo == null) {\n            throw new Error(\"Can not find inscription UTXO for sendInscriptionID\");\n        }\n        // if value is not enough to pay fee, MUST use normal UTXOs to pay fee\n        if (isUseInscriptionPayFee && maxAmountInsTransfer < estFee) {\n            isUseInscriptionPayFee = false;\n        }\n        // push inscription UTXO to create tx\n        resultUTXOs.push(inscriptionUTXO);\n    }\n    // select normal UTXOs\n    let totalSendAmount = sendAmount;\n    if (!isUseInscriptionPayFee) {\n        totalSendAmount += estFee;\n    }\n    let totalInputAmount = 0;\n    if (totalSendAmount > 0) {\n        if (normalUTXOs.length === 0) {\n            throw new Error(\"Your balance is insufficient.\");\n        }\n        normalUTXOs = normalUTXOs.sort((a, b) => {\n            if (a.value > b.value) {\n                return -1;\n            }\n            if (a.value < b.value) {\n                return 1;\n            }\n            return 0;\n        });\n        console.log(\"normalUTXOs: \", normalUTXOs);\n        if (normalUTXOs[normalUTXOs.length - 1].value >= totalSendAmount) {\n            // select the smallest utxo\n            resultUTXOs.push(normalUTXOs[normalUTXOs.length - 1]);\n            totalInputAmount = normalUTXOs[normalUTXOs.length - 1].value;\n        }\n        else if (normalUTXOs[0].value < totalSendAmount) {\n            // select multiple UTXOs\n            for (let i = 0; i < normalUTXOs.length; i++) {\n                const utxo = normalUTXOs[i];\n                resultUTXOs.push(utxo);\n                totalInputAmount += utxo.value;\n                if (totalInputAmount >= totalSendAmount) {\n                    break;\n                }\n            }\n            if (totalInputAmount < totalSendAmount) {\n                throw new Error(\"Your balance is insufficient.\");\n            }\n        }\n        else {\n            // select the nearest UTXO\n            let selectedUTXO = normalUTXOs[0];\n            for (let i = 1; i < normalUTXOs.length; i++) {\n                if (normalUTXOs[i].value < totalSendAmount) {\n                    resultUTXOs.push(selectedUTXO);\n                    totalInputAmount = selectedUTXO.value;\n                    break;\n                }\n                selectedUTXO = normalUTXOs[i];\n            }\n        }\n    }\n    // re-estimate fee with exact number of inputs and outputs\n    const { numOuts: reNumOuts } = estimateNumInOutputs(sendInscriptionID, sendAmount, isUseInscriptionPayFee);\n    let fee = estimateTxFee(resultUTXOs.length, reNumOuts, feeRatePerByte);\n    // calculate output amount\n    if (isUseInscriptionPayFee) {\n        if (maxAmountInsTransfer < fee) {\n            fee = maxAmountInsTransfer;\n        }\n        valueOutInscription = inscriptionUTXO.value - fee;\n        changeAmount = totalInputAmount - sendAmount;\n    }\n    else {\n        if (totalInputAmount < sendAmount + fee) {\n            fee = totalInputAmount - sendAmount;\n        }\n        valueOutInscription = (inscriptionUTXO === null || inscriptionUTXO === void 0 ? void 0 : inscriptionUTXO.value) || 0;\n        changeAmount = totalInputAmount - sendAmount - fee;\n    }\n    return { selectedUTXOs: resultUTXOs, isUseInscriptionPayFee: isUseInscriptionPayFee, valueOutInscription: valueOutInscription, changeAmount: changeAmount, fee: fee };\n};\n/**\n* createTx creates the Bitcoin transaction (including sending inscriptions).\n* NOTE: Currently, the function only supports sending from Taproot address.\n* @param senderPrivateKey buffer private key of the sender\n* @param utxos list of utxos (include non-inscription and inscription utxos)\n* @param inscriptions list of inscription infos of the sender\n* @param sendInscriptionID id of inscription to send\n* @param receiverInsAddress the address of the inscription receiver\n* @param sendAmount satoshi amount need to send\n* @param feeRatePerByte fee rate per byte (in satoshi)\n* @param isUseInscriptionPayFee flag defines using inscription coin to pay fee\n* @returns the transaction id\n* @returns the hex signed transaction\n* @returns the network fee\n*/\nconst createTx = (senderPrivateKey, utxos, inscriptions, sendInscriptionID = \"\", receiverInsAddress, sendAmount, feeRatePerByte, isUseInscriptionPayFeeParam = true) => {\n    const network = networks.bitcoin; // mainnet\n    // select UTXOs\n    const { selectedUTXOs, valueOutInscription, changeAmount, fee } = selectUTXOs(utxos, inscriptions, sendInscriptionID, sendAmount, feeRatePerByte, isUseInscriptionPayFeeParam);\n    console.log(\"selectedUTXOs: \", selectedUTXOs);\n    // init key pair from senderPrivateKey\n    const keypair = ECPair.fromPrivateKey(senderPrivateKey);\n    // Tweak the original keypair\n    const tweakedSigner = tweakSigner(keypair, { network });\n    // Generate an address from the tweaked public key\n    const p2pktr = payments.p2tr({\n        pubkey: toXOnly(tweakedSigner.publicKey),\n        network\n    });\n    const senderAddress = p2pktr.address ? p2pktr.address : \"\";\n    if (senderAddress === \"\") {\n        throw new Error(\"Can not get sender address from private key\");\n    }\n    const psbt = new Psbt({ network });\n    // add inputs\n    selectedUTXOs.forEach((input) => {\n        psbt.addInput({\n            hash: input.tx_hash,\n            index: input.tx_output_n,\n            witnessUtxo: { value: input.value, script: p2pktr.output },\n            tapInternalKey: toXOnly(keypair.publicKey)\n        });\n    });\n    // add outputs\n    if (sendInscriptionID !== \"\") {\n        // add output inscription\n        psbt.addOutput({\n            address: receiverInsAddress,\n            value: valueOutInscription,\n        });\n    }\n    // add output send BTC\n    if (sendAmount > 0) {\n        psbt.addOutput({\n            address: receiverInsAddress,\n            value: sendAmount,\n        });\n    }\n    // add change output\n    if (changeAmount > 0) {\n        psbt.addOutput({\n            address: senderAddress,\n            value: changeAmount,\n        });\n    }\n    // sign tx\n    selectedUTXOs.forEach((utxo, index) => {\n        var _a;\n        psbt.signInput(index, tweakedSigner);\n        console.log(\"psbt after signing tapKeySig: \", psbt.data.inputs[index].tapKeySig, (_a = psbt.data.inputs[index].tapKeySig) === null || _a === void 0 ? void 0 : _a.length);\n    });\n    psbt.finalizeAllInputs();\n    // get tx hex\n    const tx = psbt.extractTransaction();\n    console.log(\"Transaction : \", tx);\n    const txHex = tx.toHex();\n    return { txID: tx.getId(), txHex, fee, selectedUTXOs };\n};\n/**\n* createTxWithSpecificUTXOs creates the Bitcoin transaction with specific UTXOs (including sending inscriptions).\n* NOTE: Currently, the function only supports sending from Taproot address.\n* This function is used for testing.\n* @param senderPrivateKey buffer private key of the sender\n* @param utxos list of utxos (include non-inscription and inscription utxos)\n* @param sendInscriptionID id of inscription to send\n* @param receiverInsAddress the address of the inscription receiver\n* @param sendAmount amount need to send (in sat)\n* @param valueOutInscription inscription output's value (in sat)\n* @param changeAmount cardinal change amount (in sat)\n* @param fee transaction fee (in sat)\n* @returns the transaction id\n* @returns the hex signed transaction\n* @returns the network fee\n*/\nconst createTxWithSpecificUTXOs = (senderPrivateKey, utxos, sendInscriptionID = \"\", receiverInsAddress, sendAmount, valueOutInscription, changeAmount, fee) => {\n    const network = networks.bitcoin; // mainnet\n    const selectedUTXOs = utxos;\n    // init key pair from senderPrivateKey\n    const keypair = ECPair.fromPrivateKey(senderPrivateKey);\n    // Tweak the original keypair\n    const tweakedSigner = tweakSigner(keypair, { network });\n    // Generate an address from the tweaked public key\n    const p2pktr = payments.p2tr({\n        pubkey: toXOnly(tweakedSigner.publicKey),\n        network\n    });\n    const senderAddress = p2pktr.address ? p2pktr.address : \"\";\n    if (senderAddress === \"\") {\n        throw new Error(\"Can not get sender address from private key\");\n    }\n    const psbt = new Psbt({ network });\n    // add inputs\n    selectedUTXOs.forEach((input) => {\n        psbt.addInput({\n            hash: input.tx_hash,\n            index: input.tx_output_n,\n            witnessUtxo: { value: input.value, script: p2pktr.output },\n            tapInternalKey: toXOnly(keypair.publicKey)\n        });\n    });\n    // add outputs\n    if (sendInscriptionID !== \"\") {\n        // add output inscription\n        psbt.addOutput({\n            address: receiverInsAddress,\n            value: valueOutInscription,\n        });\n    }\n    // add output send BTC\n    if (sendAmount > 0) {\n        psbt.addOutput({\n            address: receiverInsAddress,\n            value: sendAmount,\n        });\n    }\n    // add change output\n    if (changeAmount > 0) {\n        psbt.addOutput({\n            address: senderAddress,\n            value: changeAmount,\n        });\n    }\n    // sign tx\n    selectedUTXOs.forEach((utxo, index) => {\n        psbt.signInput(index, tweakedSigner);\n    });\n    psbt.finalizeAllInputs();\n    // get tx hex\n    const tx = psbt.extractTransaction();\n    console.log(\"Transaction : \", tx);\n    const txHex = tx.toHex();\n    return { txID: tx.getId(), txHex, fee };\n};\nconst broadcastTx = async (txHex) => {\n    const blockstream = new axios.Axios({\n        baseURL: BlockStreamURL\n    });\n    const response = await blockstream.post(\"/tx\", txHex);\n    return response.data;\n};\nexport { selectUTXOs, createTx, broadcastTx, createTxWithSpecificUTXOs, };\n//# sourceMappingURL=tx.js.map","const getBTCBalance = (params) => {\n    const normalUTXOs = [];\n    let btcBalance = 0;\n    const { utxos, inscriptions } = params;\n    // filter normal UTXO and inscription UTXO to send\n    utxos.forEach(utxo => {\n        // txIDKey = tx_hash:tx_output_n\n        let txIDKey = utxo.tx_hash.concat(\":\");\n        txIDKey = txIDKey.concat(utxo.tx_output_n.toString());\n        // try to get inscriptionInfos\n        const inscriptionInfos = inscriptions[txIDKey];\n        if (inscriptionInfos === undefined || inscriptionInfos === null || inscriptionInfos.length == 0) {\n            // normal UTXO\n            normalUTXOs.push(utxo);\n            btcBalance += utxo.value;\n        }\n    });\n    return btcBalance;\n};\nexport { getBTCBalance, };\n//# sourceMappingURL=wallet.js.map","import { Psbt, Transaction, } from \"bitcoinjs-lib\";\nimport { network, DummyUTXOValue } from \"./constants\";\nimport { toXOnly, estimateTxFee, generateTaprootKeyPair, } from \"./utils\";\n/**\n* createPSBTForSale creates the partially signed bitcoin transaction to sale the inscription.\n* NOTE: Currently, the function only supports sending from Taproot address.\n* @param sellerPrivateKey buffer private key of the seller\n* @param sellerAddress payment address of the seller to recieve BTC from buyer\n* @param ordinalInput ordinal input coin to sell\n* @param price price of the inscription that the seller wants to sell (in satoshi)\n* @returns the encoded base64 partially signed transaction\n*/\nconst createPSBTToSale = (params) => {\n    var _a;\n    const psbt = new Psbt({ network });\n    const { ordinalInput, price, sellerAddress, sellerPrivateKey } = params;\n    const { keyPair, tweakedSigner, p2pktr } = generateTaprootKeyPair(sellerPrivateKey);\n    // const [ordinalUtxoTxId, ordinalUtxoVout] = ordinalOutput.split(':')\n    // const tx = Transaction.fromHex(await getTxHexById(ordinalUtxoTxId))\n    // for (const output in tx.outs) {\n    //     try { tx.setWitness(output, []) } catch { }\n    // }\n    // psbt.addInput({\n    //     hash: ordinalInput.tx_hash,\n    //     index: ordinalInput.tx_output_n,\n    //     nonWitnessUtxo: tx.toBuffer(),\n    //     // witnessUtxo: tx.outs[ordinalUtxoVout],\n    //     sighashType: Transaction.SIGHASH_SINGLE | Transaction.SIGHASH_ANYONECANPAY,\n    // });\n    // add ordinal input into the first input coins with \n    // sighashType: Transaction.SIGHASH_SINGLE | Transaction.SIGHASH_ANYONECANPAY\n    psbt.addInput({\n        hash: ordinalInput.tx_hash,\n        index: ordinalInput.tx_output_n,\n        witnessUtxo: { value: ordinalInput.value, script: p2pktr.output },\n        tapInternalKey: toXOnly(keyPair.publicKey),\n        sighashType: Transaction.SIGHASH_SINGLE | Transaction.SIGHASH_ANYONECANPAY,\n    });\n    console.log(\"Add input successfully\");\n    psbt.addOutput({\n        address: sellerAddress,\n        value: price,\n    });\n    // sign on the first input coin and the first output coin\n    psbt.signTaprootInput(0, tweakedSigner, undefined, [Transaction.SIGHASH_SINGLE | Transaction.SIGHASH_ANYONECANPAY]);\n    console.log(\"sign input successfully\");\n    console.log(\"psbt after signing: \", psbt);\n    console.log(\"psbt after signingtapScriptSig: \", psbt.data.inputs[0].tapScriptSig);\n    console.log(\"psbt after signing tapKeySig: \", psbt.data.inputs[0].tapKeySig, (_a = psbt.data.inputs[0].tapKeySig) === null || _a === void 0 ? void 0 : _a.length);\n    console.log(\"psbt after signing partialSig: \", psbt.data.inputs[0].partialSig);\n    // const base64Tx = psbt.toBase64();\n    // const signedContent = psbt.toHex();\n    // console.log(\"base64Tx \", base64Tx);\n    // console.log(\"signedContent \", signedContent);\n    // let signedSalePsbt;\n    // // if (signedContent.startsWith(\"02000000\") || signedContent.startsWith(\"01000000\")) {\n    //     const sellerSignedTx = Transaction.fromHex(signedContent);\n    //     const sellerSignedInput = sellerSignedTx.ins[0];\n    //     signedSalePsbt = Psbt.fromBase64(base64Tx, { network });\n    //     if (sellerSignedInput?.script?.length) {\n    //         console.log(\"0\");\n    //         signedSalePsbt.updateInput(0, {\n    //             finalScriptSig: sellerSignedInput.script,\n    //         });\n    //     }\n    //     if (sellerSignedInput?.witness?.[0]?.length) {\n    //         console.log(\"1\");\n    //         signedSalePsbt.updateInput(0, {\n    //             finalScriptWitness: witnessStackToScriptWitness(sellerSignedInput.witness),\n    //         });\n    //     }\n    //     signedSalePsbt = signedSalePsbt.toBase64();\n    // } else {\n    //     signedSalePsbt = base64Tx;\n    // }\n    psbt.finalizeAllInputs();\n    console.log(\"finalize input successfully\");\n    // const tx = psbt.extractTransaction();\n    // console.log(\"extract tx successfully\");\n    // const hexTx = tx.toHex();\n    // console.log(\"hexTx: \", hexTx);\n    // const base64Tx = psbt.toBase64();\n    // console.log(\"base64Tx: \", base64Tx);\n    // let sellerSignedTx = psbt.data.globalMap.unsignedTx;\n    // try {\n    //      sellerSignedTx = Transaction.fromHex(hexTx);\n    // } catch (e) {\n    //     console.log(\"ERr: \", e);\n    // }\n    // const sellerSignedTx = Psbt.fromHex(hexTx);\n    // console.log(\"sellerSignedTx: \", sellerSignedTx);\n    // // sellerSignedTx.\n    // const sellerSignedInput = sellerSignedTx.txInputs[0];\n    // const signedSalePsbt = Psbt.fromBase64(base64Tx, { network });\n    // if (sellerSignedInput?.script?.length) {\n    //     signedSalePsbt.updateInput(0, {\n    //         finalScriptSig: sellerSignedInput.script,\n    //     });\n    // }\n    // if (sellerSignedInput?.witness?.[0]?.length) {\n    //     signedSalePsbt.updateInput(0, {\n    //         finalScriptWitness: witnessStackToScriptWitness(sellerSignedInput.witness),\n    //     });\n    // }\n    return psbt.toBase64();\n};\n/**\n* createPSBTToBuy creates the partially signed bitcoin transaction to buy the inscription.\n* NOTE: Currently, the function only supports sending from Taproot address.\n* @param buyerPrivateKey buffer private key of the buyer\n* @param sellerAddress payment address of the seller to recieve BTC from buyer\n* @param ordinalInput ordinal input coin to sell\n* @param price price of the inscription that the seller wants to sell (in satoshi)\n* @returns the encoded base64 partially signed transaction\n*/\nconst createPSBTToBuy = (params) => {\n    const psbt = new Psbt({ network });\n    const { sellerSignedPsbt, buyerPrivateKey, buyerAddress, sellerAddress, valueInscription, price, paymentUtxos, dummyUtxo, feeRate } = params;\n    let totalValue = 0;\n    let totalPaymentValue = 0;\n    const { keyPair, tweakedSigner, p2pktr } = generateTaprootKeyPair(buyerPrivateKey);\n    // const tx = bitcoin.Transaction.fromHex(await getTxHexById(dummyUtxo.txid))\n    // for (const output in tx.outs) {\n    //     try { tx.setWitness(output, []) } catch { }\n    // }\n    // Add dummy utxo to the first input coin\n    psbt.addInput({\n        hash: dummyUtxo.tx_hash,\n        index: dummyUtxo.tx_output_n,\n        witnessUtxo: { value: dummyUtxo.value, script: p2pktr.output },\n        tapInternalKey: toXOnly(keyPair.publicKey),\n    });\n    // Add inscription output\n    // the frist output coin has value equal to the sum of dummy value and value inscription\n    // this makes sure the first output coin is inscription outcoin \n    psbt.addOutput({\n        address: sellerAddress,\n        value: dummyUtxo.value + valueInscription,\n    });\n    // Add payer signed input\n    // TODO\n    // ...sellerSignedPsbt.data.globalMap.unsignedTx.tx.ins[0],\n    psbt.addInput({\n        ...sellerSignedPsbt.txInputs[0],\n        ...sellerSignedPsbt.data.inputs[0]\n    });\n    // Add payer output\n    // ...sellerSignedPsbt.data.globalMap.unsignedTx.tx.outs[0],\n    psbt.addOutput({\n        ...sellerSignedPsbt.txOutputs[0],\n    });\n    // Add payment utxo inputs\n    for (const utxo of paymentUtxos) {\n        // const tx = bitcoin.Transaction.fromHex(await getTxHexById(utxo.txid))\n        // for (const output in tx.outs) {\n        //     try { tx.setWitness(output, []) } catch { }\n        // }\n        // psbt.addInput({\n        //     hash: utxo.txid,\n        //     index: utxo.vout,\n        //     nonWitnessUtxo: tx.toBuffer(),\n        //     // witnessUtxo: tx.outs[utxo.vout],\n        // });\n        psbt.addInput({\n            hash: utxo.tx_hash,\n            index: utxo.tx_output_n,\n            witnessUtxo: { value: utxo.value, script: p2pktr.output },\n            tapInternalKey: toXOnly(keyPair.publicKey),\n            // sighashType: Transaction.SIGHASH_SINGLE | Transaction.SIGHASH_ANYONECANPAY,\n        });\n        totalValue += utxo.value;\n        totalPaymentValue += utxo.value;\n    }\n    // Create a new dummy utxo output for the next purchase\n    psbt.addOutput({\n        address: buyerAddress,\n        value: DummyUTXOValue,\n    });\n    const fee = estimateTxFee(psbt.txInputs.length, psbt.txOutputs.length, feeRate);\n    const changeValue = totalValue - dummyUtxo.value - price - fee;\n    if (changeValue < 0) {\n        throw Error(\"Your balance is insufficient.\");\n    }\n    // Change utxo\n    psbt.addOutput({\n        address: buyerAddress,\n        value: changeValue,\n    });\n    // sign tx\n    psbt.txInputs.forEach((utxo, index) => {\n        if (index != 1) {\n            psbt.signInput(index, tweakedSigner);\n        }\n    });\n    console.log(\"sign input successfully\");\n    psbt.txInputs.forEach((utxo, index) => {\n        // utxo.\n        // if (index != 1) {\n        psbt.finalizeInput(index);\n        // }\n    });\n    console.log(\"finalize input successfully\");\n    // psbt.finalizeAllInputs();\n    // get tx hex\n    const tx = psbt.extractTransaction();\n    console.log(\"Transaction : \", tx);\n    const txHex = tx.toHex();\n    return { txID: tx.getId(), txHex, fee };\n};\nexport { createPSBTToSale, createPSBTToBuy, };\n//# sourceMappingURL=psbt.js.map"],"names":["networks","initEccLib","ecc","ECPairFactory","crypto","payments","Psbt","axios","Transaction"],"mappings":"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"}